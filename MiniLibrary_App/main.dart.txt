import 'package:flutter/material.dart';
void main() => runApp(const MiniLibrary());
class MiniLibrary extends StatelessWidget {
  const MiniLibrary({super.key});
  @override Widget build(BuildContext c) => MaterialApp(
    debugShowCheckedModeBanner: false,
    title: 'Mini Library',
    theme: ThemeData(useMaterial3: true, colorScheme: ColorScheme.fromSeed(seedColor: Colors.teal)),
    home: const Home(),
  );
}

class Book {
  final String id, title, author, shortDesc, content;
  Book({required this.id, required this.title, required this.author, required this.shortDesc, required this.content});
}

class Home extends StatefulWidget { const Home({super.key}); @override State<Home> createState() => _HomeState(); }
class _HomeState extends State<Home> {
  final List<Book> _books = [];

  void _addBook() {
    final k = GlobalKey<FormState>();
    String t = '', a = '', s = '', c = '';
    showModalBottomSheet(
      context: context, isScrollControlled: true, backgroundColor: Colors.transparent,
      builder: (_) => Padding(
        padding: EdgeInsets.only(bottom: MediaQuery.of(context).viewInsets.bottom),
        child: Container(
          decoration: BoxDecoration(color: Theme.of(context).colorScheme.surface, borderRadius: const BorderRadius.vertical(top: Radius.circular(20))),
          padding: const EdgeInsets.all(14),
          child: Form(
            key: k,
            child: SingleChildScrollView(
              child: Column(mainAxisSize: MainAxisSize.min, children: [
                Container(height:6,width:48,margin: const EdgeInsets.only(bottom:12),decoration: BoxDecoration(color: Colors.teal.withOpacity(.2),borderRadius: BorderRadius.circular(12))),
                const Text('Add Book', style: TextStyle(fontSize: 18,fontWeight: FontWeight.w700)),
                const SizedBox(height: 8),
                TextFormField(decoration: const InputDecoration(labelText: 'Title', prefixIcon: Icon(Icons.title)), onSaved: (v)=>t=v!.trim(), validator: (v)=>v!.trim().isEmpty?'Enter title':null),
                TextFormField(decoration: const InputDecoration(labelText: 'Author', prefixIcon: Icon(Icons.person)), onSaved: (v)=>a=v!.trim(), validator: (v)=>v!.trim().isEmpty?'Enter author':null),
                TextFormField(decoration: const InputDecoration(labelText: 'Short description', prefixIcon: Icon(Icons.notes)), onSaved: (v)=>s=v!.trim()),
                TextFormField(decoration: const InputDecoration(labelText: 'Full content / matter', prefixIcon: Icon(Icons.menu_book)), maxLines:5, minLines:3, onSaved:(v)=>c=v??''),
                const SizedBox(height: 12),
                FilledButton.icon(icon: const Icon(Icons.check), label: const Text('Save'), onPressed: (){
                  if(k.currentState!.validate()){ k.currentState!.save();
                    setState(()=>_books.insert(0, Book(id:DateTime.now().millisecondsSinceEpoch.toString(), title:t, author:a, shortDesc:s, content:c)));
                    Navigator.pop(context);
                  }
                }),
                const SizedBox(height:8),
              ]),
            ),
          ),
        ),
      ),
    );
  }

  void _open(Book b) => Navigator.push(context, MaterialPageRoute(builder: (_) => Detail(book: b)));
  void _delete(String id) => setState(()=> _books.removeWhere((b)=>b.id==id));

  @override Widget build(BuildContext context) {
    final cs = Theme.of(context).colorScheme;
    return Scaffold(
      body: Column(children: [
        Container(
          padding: const EdgeInsets.fromLTRB(16, 48, 16, 16),
          decoration: BoxDecoration(gradient: LinearGradient(colors:[cs.primary, cs.secondary]), borderRadius: const BorderRadius.vertical(bottom: Radius.circular(28))),
          child: Row(children: [
            const Icon(Icons.local_library_rounded, color: Colors.white, size: 28),
            const SizedBox(width: 8),
            const Text('My Library', style: TextStyle(color: Colors.white, fontSize: 22, fontWeight: FontWeight.w800)),
            const Spacer(),
            IconButton(onPressed: _addBook, icon: const Icon(Icons.add_circle_rounded, color: Colors.white))
          ]),
        ),
        const SizedBox(height: 8),
        Expanded(child: _books.isEmpty ? _Empty(onAdd: _addBook) : ListView.separated(
          padding: const EdgeInsets.all(16), itemCount: _books.length, separatorBuilder: (_,__)=>const SizedBox(height:10),
          itemBuilder: (_, i){
            final b = _books[i];
            return Dismissible(
              key: ValueKey(b.id),
              background: _swipeBg(left:true),
              secondaryBackground: _swipeBg(),
              onDismissed: (_)=>_delete(b.id),
              child: _BookTile(book: b, onTap: ()=>_open(b), onDelete: ()=>_delete(b.id)),
            );
          },
        )),
      ]),
      floatingActionButton: FloatingActionButton.extended(onPressed:_addBook, icon: const Icon(Icons.add), label: const Text('Add Book')),
    );
  }

  Widget _swipeBg({bool left=false}) => Container(
    alignment: left?Alignment.centerLeft:Alignment.centerRight,
    padding: const EdgeInsets.symmetric(horizontal:16),
    decoration: BoxDecoration(color: Colors.red.withOpacity(.1), borderRadius: BorderRadius.circular(16)),
    child: Icon(Icons.delete_forever, color: Colors.red.shade400),
  );
}

class _BookTile extends StatelessWidget {
  final Book book; final VoidCallback onTap, onDelete;
  const _BookTile({required this.book, required this.onTap, required this.onDelete});
  @override Widget build(BuildContext context) {
    final cs = Theme.of(context).colorScheme;
    return InkWell(
      onTap: onTap,
      child: Container(
        decoration: BoxDecoration(borderRadius: BorderRadius.circular(16), gradient: LinearGradient(colors: [cs.primary.withOpacity(.08), cs.secondary.withOpacity(.06)]), boxShadow: [BoxShadow(color: Colors.black12, blurRadius: 8, offset: const Offset(0,3))]),
        padding: const EdgeInsets.all(12),
        child: Row(children: [
          Container(width:52, height:68, decoration: BoxDecoration(borderRadius: BorderRadius.circular(10), gradient: LinearGradient(colors: [cs.primary, cs.secondary])), alignment: Alignment.center, child: Text(book.title.isNotEmpty?book.title[0].toUpperCase():'?', style: const TextStyle(color: Colors.white,fontWeight: FontWeight.w900,fontSize:22))),
          const SizedBox(width:12),
          Expanded(child: Column(crossAxisAlignment: CrossAxisAlignment.start, children: [
            Text(book.title, maxLines:1, overflow: TextOverflow.ellipsis, style: const TextStyle(fontWeight: FontWeight.w800, fontSize:16)),
            Text(book.author, maxLines:1, overflow: TextOverflow.ellipsis, style: TextStyle(color: cs.primary, fontWeight: FontWeight.w600)),
            const SizedBox(height:6),
            Text(book.shortDesc, maxLines:2, overflow: TextOverflow.ellipsis),
          ])),
          IconButton(onPressed: onDelete, icon: Icon(Icons.delete_outline, color: Colors.red.shade400)),
          const Icon(Icons.chevron_right_rounded),
        ]),
      ),
    );
  }
}

class Detail extends StatelessWidget {
  final Book book; const Detail({super.key, required this.book});
  @override Widget build(BuildContext context){
    final cs = Theme.of(context).colorScheme;
    return Scaffold(
      body: Column(children: [
        Container(
          padding: const EdgeInsets.fromLTRB(16, 48, 16, 16),
          decoration: BoxDecoration(gradient: LinearGradient(colors:[cs.primary, cs.secondary]), borderRadius: const BorderRadius.vertical(bottom: Radius.circular(28))),
          child: Column(crossAxisAlignment: CrossAxisAlignment.start, children: [
            Row(children:[IconButton(onPressed: ()=>Navigator.pop(context), icon: const Icon(Icons.arrow_back, color: Colors.white)), const Spacer()]),
            Text(book.title, style: const TextStyle(color: Colors.white, fontSize: 22, fontWeight: FontWeight.w900)),
            const SizedBox(height: 4),
            Text('by ${book.author}', style: TextStyle(color: Colors.white.withOpacity(.9))),
            const SizedBox(height: 12),
          ]),
        ),
        Expanded(child: SingleChildScrollView(padding: const EdgeInsets.all(16), child: Column(crossAxisAlignment: CrossAxisAlignment.start, children: [
          Text(book.shortDesc, style: TextStyle(color: cs.primary, fontWeight: FontWeight.w700)),
          const Divider(height: 24),
          Text(book.content.isEmpty ? '(No content provided)' : book.content, textAlign: TextAlign.justify),
        ]))),
      ]),
    );
  }
}

class _Empty extends StatelessWidget {
  final VoidCallback onAdd; const _Empty({required this.onAdd});
  @override Widget build(BuildContext context) => Center(child: Padding(padding: const EdgeInsets.all(24), child: Column(mainAxisSize: MainAxisSize.min, children: [
    Icon(Icons.menu_book_rounded, size:88, color: Colors.teal.shade200),
    const SizedBox(height:12),
    const Text('Your shelf is empty', style: TextStyle(fontSize:18, fontWeight: FontWeight.w800)),
    const SizedBox(height:6),
    const Text('Tap below to add a book with description and full content.'),
    const SizedBox(height:16),
    FilledButton.icon(onPressed: onAdd, icon: const Icon(Icons.add), label: const Text('Add Book')),
  ])));
}
